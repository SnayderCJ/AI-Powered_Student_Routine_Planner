{% extends 'base.html' %} {% load planner_tags %} {% block content %}
<div class="tareas-container">
  <div class="tareas-header">
    <h1 class="tareas-title">Tareas de la Semana</h1>
    <div class="tareas-week-range">{{ current_week_range }}</div>
  </div>

  <div class="tareas-stats-bar">
    <div class="tareas-stat-item total">
      <span class="tareas-stat-number">{{ total_events }}</span> Total
    </div>
    <div class="tareas-stat-item completed">
      <span class="tareas-stat-number">{{ completed_events }}</span> Completadas
    </div>
    <div class="tareas-stat-item pending">
      <span class="tareas-stat-number">{{ pending_events }}</span> Pendientes
    </div>
  </div>

  <div class="tareas-week-grid">
    {% for day_data in week_days_data %}
    <div class="tareas-day-column {% if day_data.is_today %}today{% endif %}">
      <div class="tareas-day-header">
        <div class="tareas-day-name">{{ day_data.day_name }}</div>
        <div class="tareas-day-number">{{ day_data.day_num }}</div>
      </div>

      <div class="tareas-events-list">
        {% if day_data.events %} {% for event in day_data.events %}
        <div
          class="tareas-event-item {% if event.is_completed %}completed{% endif %} event-{{ event.event_type }} priority-{{ event.priority|lower }}"
          onclick="toggleEventCompletion({{ event.id }})"
        >
          <div class="tareas-event-checkbox"></div>

          <div class="tareas-event-content">
            <div class="tareas-event-title">{{ event.title }}</div>
            <div class="tareas-event-time">
              {{ event.start_time|time:"d/m/Y" }}
            </div>
          </div>

          <div class="tareas-event-indicator"></div>
        </div>
        {% endfor %} {% else %}
        <div class="tareas-no-events">Sin eventos programados</div>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
</div>

{% csrf_token %}
<script>
  // FunciÃ³n para actualizar estado de completado via AJAX
  function toggleEventCompletion(eventId) {
    fetch(`/planner/event/${eventId}/toggle/`, {
      method: "POST",
      headers: {
        "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]")
          .value,
        "Content-Type": "application/json",
      },
    })
      .then((response) => response.json())
      .then((data) => {
        if (data.success) {
          location.reload(); // Recargar para mostrar cambios
        }
      });
  }
</script>
{% endblock content %}
