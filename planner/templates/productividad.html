{% extends 'base.html' %}
{% load static %}

{% block content %}
<main class="main-content">
  <section class="productividad-section">
    <h2>Análisis de Productividad</h2>

    <div class="graficos-container">
      <div class="grafico-barras">
        <canvas id="graficoProductividad"></canvas>
      </div>

      <div class="tarjeta-productividad">
        <p class="titulo-subseccion">Productividad de Hoy</p>
        <div class="donut-container">
          <canvas id="donutChart" width="150" height="150"></canvas>
          <div class="donut-text">
            <span id="donutPorcentaje">{{ productividad_hoy }}%</span>
            <p>Progreso</p>
          </div>
        </div>
        <div class="sugerencias">
          <p>
            {% if dif_ayer_valor > 0 %}
              {% if dif_ayer_positivo %}
                Estás un {{ dif_ayer_valor }}% más productivo que ayer
              {% else %}
                Estás un {{ dif_ayer_valor }}% menos productivo que ayer
              {% endif %}
            {% else %}
              Igual que ayer
            {% endif %}
          </p>
          <p>
            {% if dif_promedio_valor > 0 %}
              {% if dif_promedio_positivo %}
                {{ dif_promedio_valor }}% más que tu promedio semanal
              {% else %}
                {{ dif_promedio_valor }}% menos que tu promedio semanal
              {% endif %}
            {% else %}
              Igual que tu promedio semanal
            {% endif %}
          </p>
        </div>
      </div>
    </div>

    <div class="patrones-identificados">
      <h3>🧠 Patrones Identificados</h3>
      <ul>
        <li>- Tu día más productivo es: <strong>{{ dia_productivo }}</strong></li>
        <li>- Mayor rendimiento: <strong>{{ mejor_rango }}</strong></li>
      </ul>
    </div>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const ctx = document.getElementById('graficoProductividad').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo'],
        datasets: [{
          label: 'Nivel de Productividad',
          data: {{ productividad_dias|safe }},
          backgroundColor: ['#6EE7B7', '#3B82F6', '#818CF8', '#A78BFA', '#F472B6', '#FBBF24', '#F87171'],
          borderRadius: 6,
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, ticks: { color: '#ddd' } },
          x: { ticks: { color: '#ddd' } }
        }
      }
    });

    const donutCtx = document.getElementById("donutChart").getContext("2d");
    const porcentajeFinal = {{ productividad_hoy }};
    const restante = 100 - porcentajeFinal;

    new Chart(donutCtx, {
      type: 'doughnut',
      data: {
        labels: ['Productivo', 'Restante'],
        datasets: [{
          data: [porcentajeFinal, restante],
          backgroundColor: ['#A020F0', '#3f3f46'],
          borderWidth: 0,
          cutout: '75%',
        }]
      },
      options: {
        responsive: false,
        animation: {
          animateRotate: true,
          duration: 1000,
          onProgress: function(animation) {
            const progress = animation.currentStep / animation.numSteps;
            const valorAnimado = Math.round(porcentajeFinal * progress);
            document.getElementById("donutPorcentaje").textContent = valorAnimado + "%";
          }
        },
        plugins: { legend: { display: false } }
      }
    });
  });
</script>
{% endblock %}
